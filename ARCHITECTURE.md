# ChaoX çŸ¥è¯†åº“ç®¡ç†ç³»ç»Ÿæ¶æ„è®¾è®¡

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Client Layer (å®¢æˆ·ç«¯å±‚)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   ç”¨æˆ·å‰ç«¯ (React)   â”‚         â”‚  ç®¡ç†åå°å‰ç«¯ (React)         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ - æœç´¢ç•Œé¢          â”‚         â”‚ - ç™»å½•ç•Œé¢                   â”‚   â”‚
â”‚  â”‚ - æ–‡æ¡£ä¸Šä¼           â”‚         â”‚ - ä»ªè¡¨æ¿                     â”‚   â”‚
â”‚  â”‚ - ç»“æœå±•ç¤º          â”‚         â”‚ - æ–‡æ¡£ç®¡ç†                   â”‚   â”‚
â”‚  â”‚ - KaTeXæ¸²æŸ“         â”‚         â”‚ - åˆ†ç‰‡ç®¡ç†                   â”‚   â”‚
â”‚  â”‚                     â”‚         â”‚ - é¢˜åº“ç®¡ç†                   â”‚   â”‚
â”‚  â”‚ Port: 5173          â”‚         â”‚ - ç”¨æˆ·ç®¡ç†                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ - å®¡è®¡æ—¥å¿—                   â”‚   â”‚
â”‚            â”‚                     â”‚ - ç»Ÿè®¡åˆ†æ                   â”‚   â”‚
â”‚            â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                                  â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                  â”‚
             â”‚  HTTP/REST                       â”‚  HTTP/REST + JWT
             â”‚                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Application Layer (åº”ç”¨å±‚)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚                      FastAPI Application (Python)                     â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      ç”¨æˆ·ç«¯API              â”‚      ç®¡ç†åå°API                 â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                              â”‚                                 â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚ â”‚   ingest.py             â”‚  â”‚  â”‚  admin/routes/             â”‚â”‚ â”‚
â”‚  â”‚ â”‚   - æ–‡æ¡£è§£æ            â”‚  â”‚  â”‚  â”œâ”€ auth_routes.py         â”‚â”‚ â”‚
â”‚  â”‚ â”‚   - H1/H2æå–           â”‚  â”‚  â”‚  â”œâ”€ doc_routes.py          â”‚â”‚ â”‚
â”‚  â”‚ â”‚   - æ™ºèƒ½åˆ†ç‰‡            â”‚  â”‚  â”‚  â”œâ”€ chunk_routes.py        â”‚â”‚ â”‚
â”‚  â”‚ â”‚   - å…³é”®å­—åˆ†ç±»          â”‚  â”‚  â”‚  â”œâ”€ question_routes.py     â”‚â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”œâ”€ user_routes.py         â”‚â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚  â”œâ”€ audit_routes.py        â”‚â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â””â”€ stats_routes.py        â”‚â”‚ â”‚
â”‚  â”‚ â”‚   search.py             â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â”‚ â”‚   - å…¨æ–‡æ£€ç´¢            â”‚  â”‚                                 â”‚ â”‚
â”‚  â”‚ â”‚   - ç›¸ä¼¼åº¦æ‰“åˆ†          â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚ â”‚   - åˆ†é¡µæŸ¥è¯¢            â”‚  â”‚  â”‚  admin/services/           â”‚â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”œâ”€ user_service.py        â”‚â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚  â”œâ”€ doc_service.py          â”‚â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”œâ”€ chunk_service.py       â”‚â”‚ â”‚
â”‚  â”‚ â”‚   ingest_qbank.py       â”‚  â”‚  â”‚  â”œâ”€ question_service.py    â”‚â”‚ â”‚
â”‚  â”‚ â”‚   - é¢˜åº“è§£æ            â”‚  â”‚  â”‚  â”œâ”€ audit_service.py       â”‚â”‚ â”‚
â”‚  â”‚ â”‚   - å›¾ç‰‡æå–            â”‚  â”‚  â”‚  â””â”€ stats_service.py        â”‚â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â”‚                              â”‚                                 â”‚ â”‚
â”‚  â”‚                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚  admin/auth.py             â”‚â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚  - JWTéªŒè¯                 â”‚â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚  - æƒé™æ£€æŸ¥                â”‚â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚  - è§’è‰²ç®¡ç†                â”‚â”‚ â”‚
â”‚  â”‚                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      Shared Layer (å…±äº«å±‚)                      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  db.py           - æ•°æ®åº“è¿æ¥æ± ç®¡ç†                            â”‚  â”‚
â”‚  â”‚  utils/          - å·¥å…·å‡½æ•°ï¼ˆå¯†ç åŠ å¯†ã€JWTã€å¯¼å‡ºï¼‰              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â”‚                         Port: 8787                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚  SQL / psycopg2
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Database Layer (æ•°æ®åº“å±‚)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚                    PostgreSQL 15 + Extensions                         â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     ä¸šåŠ¡æ•°æ®è¡¨              â”‚      ç®¡ç†ç³»ç»Ÿè¡¨                  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                              â”‚                                 â”‚ â”‚
â”‚  â”‚  doc                         â”‚  admin_user                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ doc_id (PK)              â”‚  â”œâ”€ user_id (PK)                â”‚ â”‚
â”‚  â”‚  â”œâ”€ title                    â”‚  â”œâ”€ username (UNIQUE)           â”‚ â”‚
â”‚  â”‚  â”œâ”€ chapter                  â”‚  â”œâ”€ password_hash               â”‚ â”‚
â”‚  â”‚  â”œâ”€ section_number           â”‚  â”œâ”€ role                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ source (kb/qb)           â”‚  â”œâ”€ is_active                   â”‚ â”‚
â”‚  â”‚  â”œâ”€ sha256 (UNIQUE)          â”‚  â””â”€ last_login_at               â”‚ â”‚
â”‚  â”‚  â”œâ”€ is_published  ğŸ†•         â”‚                                 â”‚ â”‚
â”‚  â”‚  â””â”€ deleted_at    ğŸ†•         â”‚  audit_log                      â”‚ â”‚
â”‚  â”‚                              â”‚  â”œâ”€ log_id (PK)                 â”‚ â”‚
â”‚  â”‚  chunk                       â”‚  â”œâ”€ user_id (FK)                â”‚ â”‚
â”‚  â”‚  â”œâ”€ chunk_id (PK)            â”‚  â”œâ”€ action                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ doc_id (FK)              â”‚  â”œâ”€ resource_type               â”‚ â”‚
â”‚  â”‚  â”œâ”€ kind                     â”‚  â”œâ”€ resource_id                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ heading_h1/h2            â”‚  â”œâ”€ details (JSONB)             â”‚ â”‚
â”‚  â”‚  â”œâ”€ content_md               â”‚  â””â”€ created_at                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ content_plain            â”‚                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ is_verified   ğŸ†•         â”‚  kb_category                    â”‚ â”‚
â”‚  â”‚  â”œâ”€ quality_score ğŸ†•         â”‚  â”œâ”€ category_id (PK)            â”‚ â”‚
â”‚  â”‚  â””â”€ deleted_at    ğŸ†•         â”‚  â”œâ”€ name                        â”‚ â”‚
â”‚  â”‚                              â”‚  â””â”€ parent_id (FK)              â”‚ â”‚
â”‚  â”‚  question                    â”‚                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ qid (PK)                 â”‚  tag                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ qtype                    â”‚  â”œâ”€ tag_id (PK)                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ stem_md                  â”‚  â””â”€ name                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ options_json (JSONB)     â”‚                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ answer_text              â”‚  doc_category (å…³è”è¡¨)          â”‚ â”‚
â”‚  â”‚  â”œâ”€ difficulty               â”‚  chunk_tag (å…³è”è¡¨)             â”‚ â”‚
â”‚  â”‚  â”œâ”€ is_published  ğŸ†•         â”‚                                 â”‚ â”‚
â”‚  â”‚  â””â”€ deleted_at    ğŸ†•         â”‚                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     Indexes & Views                             â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  - idx_chunk_plain_trgm (GIN)  - å…¨æ–‡æ£€ç´¢                      â”‚  â”‚
â”‚  â”‚  - idx_chunk_kind              - ç±»å‹æŸ¥è¯¢                      â”‚  â”‚
â”‚  â”‚  - idx_audit_user              - å®¡è®¡æŸ¥è¯¢                      â”‚  â”‚
â”‚  â”‚  - v_admin_stats               - ç³»ç»Ÿç»Ÿè®¡è§†å›¾                  â”‚  â”‚
â”‚  â”‚  - v_doc_stats                 - æ–‡æ¡£ç»Ÿè®¡è§†å›¾                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â”‚  Extensions: pg_trgm (ç›¸ä¼¼åº¦æœç´¢), vector (å¯é€‰ï¼Œå‘é‡æœç´¢)             â”‚
â”‚                                                                       â”‚
â”‚                         Port: 5432                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ¨¡å—èŒè´£

### 1. ç”¨æˆ·ç«¯æ¨¡å—

**æ–‡æ¡£å¤„ç† (ingest.py)**
- è§£æ `.docx` æ–‡ä»¶
- æå– H1/H2 æ ‡é¢˜
- æ™ºèƒ½åˆ†ç‰‡ï¼ˆæœ€å¤§1200å­—ï¼Œé‡å 120å­—ï¼‰
- è‡ªåŠ¨åˆ†ç±»ï¼ˆdefinition/theorem/formula/example/property/remarkï¼‰
- å»é‡ï¼ˆåŸºäºSHA256ï¼‰

**æœç´¢å¼•æ“ (search.py)**
- å…¨æ–‡æ£€ç´¢ï¼ˆä½¿ç”¨ pg_trgmï¼‰
- ç›¸ä¼¼åº¦æ‰“åˆ†
- å¤šæ¡ä»¶è¿‡æ»¤ï¼ˆç±»å‹ã€ç« èŠ‚ã€æ¥æºï¼‰
- åˆ†é¡µä¸æ’åº
- ä¸Šä¸‹æ–‡åˆ†ç‰‡è·å–

**é¢˜åº“ç®¡ç† (ingest_qbank.py)**
- é¢˜ç›®è§£æ
- å›¾ç‰‡æå–å­˜å‚¨
- é¢˜å‹è¯†åˆ«ï¼ˆé€‰æ‹©é¢˜/å¡«ç©ºé¢˜/è§£ç­”é¢˜ï¼‰

### 2. ç®¡ç†åå°æ¨¡å—

**è®¤è¯ä¸æƒé™ (admin/auth.py)**
- JWTä»¤ç‰Œç”Ÿæˆä¸éªŒè¯
- 4çº§æƒé™æ§åˆ¶
- è£…é¥°å™¨æƒé™æ£€æŸ¥

**ä¸šåŠ¡æœåŠ¡å±‚ (admin/services/)**
- `user_service.py` - ç”¨æˆ·ç®¡ç†
- `doc_service.py` - æ–‡æ¡£ç®¡ç†
- `chunk_service.py` - åˆ†ç‰‡ç®¡ç†
- `question_service.py` - é¢˜åº“ç®¡ç†
- `audit_service.py` - å®¡è®¡æ—¥å¿—
- `stats_service.py` - ç»Ÿè®¡åˆ†æ

**è·¯ç”±å±‚ (admin/routes/)**
- RESTful APIè®¾è®¡
- è¯·æ±‚éªŒè¯ï¼ˆPydanticï¼‰
- å“åº”æ ¼å¼ç»Ÿä¸€
- é”™è¯¯å¤„ç†

**å·¥å…·å±‚ (utils/)**
- `password.py` - bcryptå¯†ç åŠ å¯†
- `jwt_handler.py` - JWTä»¤ç‰Œå¤„ç†
- `export.py` - æ•°æ®å¯¼å‡ºï¼ˆCSV/JSONï¼‰

---

## ğŸ”„ æ•°æ®æµç¤ºä¾‹

### ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£æµç¨‹

```
1. ç”¨æˆ· â†’ POST /ingest (file.docx)
2. ingest.py â†’ è§£ææ–‡æ¡£ç»“æ„
3. ingest.py â†’ åˆ†ç‰‡å¤„ç†
4. ingest.py â†’ è®¡ç®—SHA256
5. db.py â†’ æ’å…¥docè¡¨
6. db.py â†’ æ‰¹é‡æ’å…¥chunkè¡¨
7. â† è¿”å› {doc_id, chunks_count}
```

### ç®¡ç†å‘˜åˆ é™¤æ–‡æ¡£æµç¨‹

```
1. ç®¡ç†å‘˜ â†’ DELETE /admin/docs/{id} (with JWT)
2. auth.py â†’ éªŒè¯Token
3. auth.py â†’ æ£€æŸ¥æƒé™ (require_editor)
4. doc_service.py â†’ è½¯åˆ é™¤doc
5. doc_service.py â†’ çº§è”è½¯åˆ é™¤chunks
6. audit_service.py â†’ è®°å½•å®¡è®¡æ—¥å¿—
7. db.py â†’ æäº¤äº‹åŠ¡
8. â† è¿”å› {ok: true}
```

### ç»Ÿè®¡åˆ†ææµç¨‹

```
1. ç®¡ç†å‘˜ â†’ GET /admin/stats/dashboard
2. auth.py â†’ éªŒè¯æƒé™
3. stats_service.py â†’ æŸ¥è¯¢v_admin_statsè§†å›¾
4. stats_service.py â†’ æŸ¥è¯¢recent_uploads
5. stats_service.py â†’ åˆ†æå®¡è®¡æ—¥å¿—
6. stats_service.py â†’ è®¡ç®—å­˜å‚¨ä½¿ç”¨
7. â† è¿”å›å®Œæ•´ä»ªè¡¨æ¿æ•°æ®
```

---

## ğŸ” å®‰å…¨æœºåˆ¶

### 1. è®¤è¯æµç¨‹

```
ç™»å½• â†’ éªŒè¯ç”¨æˆ·åå¯†ç  â†’ ç”ŸæˆJWT Token â†’ å®¢æˆ·ç«¯ä¿å­˜Token
     â†“
åç»­è¯·æ±‚ â†’ Headeræºå¸¦Token â†’ è§£ç éªŒè¯ â†’ æ£€æŸ¥è¿‡æœŸ â†’ è·å–ç”¨æˆ·ä¿¡æ¯
     â†“
æƒé™æ£€æŸ¥ â†’ æ¯”å¯¹è§’è‰²å±‚çº§ â†’ å…è®¸/æ‹’ç»è®¿é—®
```

### 2. æƒé™çŸ©é˜µ

| æ“ä½œ | viewer | editor | admin | superadmin |
|-----|--------|--------|-------|-----------|
| æŸ¥çœ‹å†…å®¹ | âœ… | âœ… | âœ… | âœ… |
| ç¼–è¾‘å†…å®¹ | âŒ | âœ… | âœ… | âœ… |
| åˆ é™¤å†…å®¹ | âŒ | âœ… | âœ… | âœ… |
| æŸ¥çœ‹å®¡è®¡æ—¥å¿— | âŒ | âŒ | âœ… | âœ… |
| ç®¡ç†ç”¨æˆ· | âŒ | âŒ | âŒ | âœ… |

### 3. æ•°æ®ä¿æŠ¤

- **è½¯åˆ é™¤**ï¼šè®¾ç½® `deleted_at` è€Œéç‰©ç†åˆ é™¤
- **å®¡è®¡è¿½è¸ª**ï¼šæ‰€æœ‰æ“ä½œè®°å½•åˆ° `audit_log`
- **å¯†ç å®‰å…¨**ï¼šbcryptåŠ å¯†ï¼Œä¸å¯é€†
- **Tokenè¿‡æœŸ**ï¼šé»˜è®¤24å°æ—¶è‡ªåŠ¨å¤±æ•ˆ

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–

- **ç´¢å¼•ç­–ç•¥**
  - GINç´¢å¼•ï¼šå…¨æ–‡æ£€ç´¢ï¼ˆpg_trgmï¼‰
  - B-treeç´¢å¼•ï¼šä¸»é”®ã€å¤–é”®ã€å¸¸æŸ¥å­—æ®µ
  - å¤åˆç´¢å¼•ï¼šå¤šæ¡ä»¶æŸ¥è¯¢

- **è§†å›¾ä¼˜åŒ–**
  - é¢„è®¡ç®—ç»Ÿè®¡æ•°æ®
  - å‡å°‘å¤æ‚JOIN

### 2. è¿æ¥æ± ç®¡ç†

```python
SimpleConnectionPool(
    minconn=1,    # æœ€å°è¿æ¥æ•°
    maxconn=10    # æœ€å¤§è¿æ¥æ•°
)
```

### 3. æŸ¥è¯¢ä¼˜åŒ–

- åˆ†é¡µæŸ¥è¯¢ï¼šLIMIT + OFFSET
- æ‡’åŠ è½½ï¼šæŒ‰éœ€åŠ è½½å…³è”æ•°æ®
- æ‰¹é‡æ“ä½œï¼šå‡å°‘æ•°æ®åº“å¾€è¿”

---

## ğŸš€ æ‰©å±•æ€§è®¾è®¡

### 1. æ°´å¹³æ‰©å±•

```
Load Balancer (Nginx)
       â”‚
    â”Œâ”€â”€â”´â”€â”€â”
    â”‚     â”‚
 Backend Backend  (å¤šä¸ªFastAPIå®ä¾‹)
    â”‚     â”‚
    â””â”€â”€â”¬â”€â”€â”˜
       â”‚
  PostgreSQL (ä¸»ä»å¤åˆ¶)
```

### 2. ç¼“å­˜å±‚ï¼ˆå¯é€‰ï¼‰

```
Client â†’ Backend â†’ Redis Cache â†’ PostgreSQL
                      â†“
                   å‘½ä¸­è¿”å›
```

### 3. å¾®æœåŠ¡æ‹†åˆ†ï¼ˆé•¿æœŸï¼‰

- è®¤è¯æœåŠ¡
- æ–‡æ¡£å¤„ç†æœåŠ¡
- æœç´¢æœåŠ¡
- ç»Ÿè®¡åˆ†ææœåŠ¡

---

## ğŸ› ï¸ æŠ€æœ¯é€‰å‹ç†ç”±

### ä¸ºä»€ä¹ˆé€‰æ‹©Pythonï¼Ÿ

1. âœ… **æŠ€æœ¯æ ˆç»Ÿä¸€**ï¼šä¸ç°æœ‰åç«¯ä¸€è‡´
2. âœ… **ä»£ç å¤ç”¨**ï¼šç›´æ¥å¤ç”¨db.pyã€search.pyç­‰
3. âœ… **å¿«é€Ÿå¼€å‘**ï¼šFastAPIè‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£
4. âœ… **ç»´æŠ¤æˆæœ¬ä½**ï¼šå•ä¸€è¯­è¨€ï¼Œé™ä½å­¦ä¹ æ›²çº¿

### ä¸ºä»€ä¹ˆé€‰æ‹©FastAPIï¼Ÿ

1. âœ… **ç°ä»£åŒ–**ï¼šå¼‚æ­¥æ”¯æŒã€ç±»å‹æç¤º
2. âœ… **é«˜æ€§èƒ½**ï¼šæ¥è¿‘Go/Node.jsæ€§èƒ½
3. âœ… **è‡ªåŠ¨æ–‡æ¡£**ï¼šSwagger/ReDocå¼€ç®±å³ç”¨
4. âœ… **æ•°æ®éªŒè¯**ï¼šPydanticè‡ªåŠ¨éªŒè¯

### ä¸ºä»€ä¹ˆé€‰æ‹©PostgreSQLï¼Ÿ

1. âœ… **åŠŸèƒ½ä¸°å¯Œ**ï¼šJSONBã€å…¨æ–‡æ£€ç´¢ã€æ•°ç»„
2. âœ… **æ‰©å±•æ€§å¼º**ï¼špg_trgmã€pgvector
3. âœ… **äº‹åŠ¡æ”¯æŒ**ï¼šACIDä¿è¯æ•°æ®ä¸€è‡´æ€§
4. âœ… **å·²æœ‰æ•°æ®**ï¼šå¤ç”¨ç°æœ‰æ•°æ®åº“

---

## ğŸ“ˆ æœªæ¥æ¶æ„æ¼”è¿›

### Phase 1: å½“å‰ (v0.2.0)
- å•ä½“åº”ç”¨
- PostgreSQLå•æœº
- æ— ç¼“å­˜

### Phase 2: ä¼˜åŒ– (v0.3.0)
- æ·»åŠ Redisç¼“å­˜
- è¯»å†™åˆ†ç¦»
- CDNåŠ é€Ÿé™æ€èµ„æº

### Phase 3: å¾®æœåŠ¡ (v0.4.0)
- æœåŠ¡æ‹†åˆ†
- æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRabbitMQ/Kafkaï¼‰
- åˆ†å¸ƒå¼è¿½è¸ª

### Phase 4: æ™ºèƒ½åŒ– (v0.5.0)
- å‘é‡æœç´¢ï¼ˆpgvectorï¼‰
- AIè¾…åŠ©åˆ†ç‰‡
- æ™ºèƒ½æ¨èç³»ç»Ÿ

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•
```python
# æµ‹è¯•æœåŠ¡å±‚
def test_authenticate_user():
    user = authenticate_user("admin", "admin123")
    assert user["username"] == "admin"
```

### 2. é›†æˆæµ‹è¯•
```python
# æµ‹è¯•APIç«¯ç‚¹
def test_login_api():
    response = client.post("/admin/auth/login", json={...})
    assert response.status_code == 200
```

### 3. æ€§èƒ½æµ‹è¯•
```bash
# ä½¿ç”¨Apache Bench
ab -n 1000 -c 10 http://localhost:8787/search
```

---

## ğŸ“ æ€»ç»“

ChaoXç®¡ç†ç³»ç»Ÿé‡‡ç”¨**åˆ†å±‚æ¶æ„**è®¾è®¡ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **æ¨¡å—åŒ–**ï¼šæ¸…æ™°çš„èŒè´£åˆ’åˆ†
2. **å¯æ‰©å±•**ï¼šæ˜“äºæ·»åŠ æ–°åŠŸèƒ½
3. **å¯ç»´æŠ¤**ï¼šä»£ç ç»“æ„æ¸…æ™°
4. **å®‰å…¨æ€§**ï¼šå®Œå–„çš„è®¤è¯æˆæƒ
5. **å¯è§‚æµ‹**ï¼šå®¡è®¡æ—¥å¿—è¿½è¸ª
6. **é«˜æ€§èƒ½**ï¼šæ•°æ®åº“ä¼˜åŒ–

è¿™æ˜¯ä¸€ä¸ª**ç”Ÿäº§å°±ç»ª**çš„ç®¡ç†ç³»ç»Ÿæ¶æ„ï¼Œå¯ä»¥æ”¯æ’‘ä¸­å°å‹çŸ¥è¯†åº“çš„è¿è¥éœ€æ±‚ã€‚

