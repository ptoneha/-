# ğŸ¯ ChaoX çŸ¥è¯†åº“ç®¡ç†ç³»ç»Ÿ

åŸºäºPython/FastAPIæ„å»ºçš„å®Œæ•´çŸ¥è¯†åº“ç®¡ç†ç³»ç»Ÿï¼ŒåŒ…å«ç”¨æˆ·ç«¯å’Œç®¡ç†åå°ã€‚

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
chaoX/
â”œâ”€â”€ backend/                    # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ app.py                  # ä¸»åº”ç”¨ï¼ˆå·²é›†æˆç®¡ç†ç³»ç»Ÿï¼‰
â”‚   â”œâ”€â”€ db.py                   # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ ingest.py               # æ–‡æ¡£å¤„ç†
â”‚   â”œâ”€â”€ search.py               # æœç´¢åŠŸèƒ½
â”‚   â”‚
â”‚   â”œâ”€â”€ admin/                  # ğŸ†• ç®¡ç†ç³»ç»Ÿæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ router.py           # ä¸»è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ auth.py             # è®¤è¯ä¸æƒé™
â”‚   â”‚   â”œâ”€â”€ db_init.py          # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ models/             # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”‚   â”œâ”€â”€ audit.py
â”‚   â”‚   â”‚   â””â”€â”€ stats.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ user_service.py
â”‚   â”‚   â”‚   â”œâ”€â”€ doc_service.py
â”‚   â”‚   â”‚   â”œâ”€â”€ chunk_service.py
â”‚   â”‚   â”‚   â”œâ”€â”€ question_service.py
â”‚   â”‚   â”‚   â”œâ”€â”€ audit_service.py
â”‚   â”‚   â”‚   â””â”€â”€ stats_service.py
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ routes/             # APIè·¯ç”±
â”‚   â”‚       â”œâ”€â”€ auth_routes.py
â”‚   â”‚       â”œâ”€â”€ doc_routes.py
â”‚   â”‚       â”œâ”€â”€ chunk_routes.py
â”‚   â”‚       â”œâ”€â”€ question_routes.py
â”‚   â”‚       â”œâ”€â”€ user_routes.py
â”‚   â”‚       â”œâ”€â”€ audit_routes.py
â”‚   â”‚       â””â”€â”€ stats_routes.py
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                  # ğŸ†• å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ password.py         # å¯†ç åŠ å¯†
â”‚   â”‚   â”œâ”€â”€ jwt_handler.py      # JWTå¤„ç†
â”‚   â”‚   â””â”€â”€ export.py           # å¯¼å‡ºåŠŸèƒ½
â”‚   â”‚
â”‚   â”œâ”€â”€ admin_schema.sql        # ğŸ†• ç®¡ç†ç³»ç»Ÿæ•°æ®åº“ç»“æ„
â”‚   â”œâ”€â”€ requirements.txt        # Pythonä¾èµ–ï¼ˆå·²æ›´æ–°ï¼‰
â”‚   â”œâ”€â”€ ADMIN_GUIDE.md          # ğŸ†• ä½¿ç”¨æŒ‡å—
â”‚   â””â”€â”€ DEPLOYMENT.md           # ğŸ†• éƒ¨ç½²æŒ‡å—
â”‚
â”œâ”€â”€ frontend/                   # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ Search.tsx      # æœç´¢é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ Upload.tsx      # ä¸Šä¼ é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ UploadQB.tsx    # é¢˜åº“ä¸Šä¼ 
â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚
â”‚   â””â”€â”€ ... (å¾…æ‰©å±•ç®¡ç†åå°å‰ç«¯)
â”‚
â”œâ”€â”€ docker-compose.yml          # Dockerç¼–æ’
â””â”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
```

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ç”¨æˆ·ç«¯åŠŸèƒ½
- âœ… æ–‡æ¡£ä¸Šä¼ ï¼ˆ.docxï¼‰
- âœ… æ™ºèƒ½åˆ†ç‰‡å¤„ç†
- âœ… å…¨æ–‡æ£€ç´¢
- âœ… é¢˜åº“ç®¡ç†
- âœ… KaTeXæ•°å­¦å…¬å¼æ¸²æŸ“

### ç®¡ç†åå°åŠŸèƒ½
- ğŸ†• **ç”¨æˆ·è®¤è¯**ï¼šåŸºäºJWTçš„å®‰å…¨è®¤è¯
- ğŸ†• **æƒé™ç®¡ç†**ï¼š4çº§æƒé™ä½“ç³»ï¼ˆsuperadmin/admin/editor/viewerï¼‰
- ğŸ†• **æ–‡æ¡£ç®¡ç†**ï¼šCRUDæ“ä½œã€æ‰¹é‡åˆ é™¤ã€å‘å¸ƒæ§åˆ¶
- ğŸ†• **åˆ†ç‰‡ç®¡ç†**ï¼šå†…å®¹å®¡æ ¸ã€è´¨é‡è¯„åˆ†ã€æ‰¹é‡æ“ä½œ
- ğŸ†• **é¢˜åº“ç®¡ç†**ï¼šé¢˜ç›®ç¼–è¾‘ã€åˆ†ç±»ç®¡ç†ã€å‘å¸ƒæ§åˆ¶
- ğŸ†• **ç”¨æˆ·ç®¡ç†**ï¼šè´¦æˆ·ç®¡ç†ã€è§’è‰²åˆ†é…
- ğŸ†• **å®¡è®¡æ—¥å¿—**ï¼šå®Œæ•´çš„æ“ä½œè¿½è¸ª
- ğŸ†• **ç»Ÿè®¡åˆ†æ**ï¼šä»ªè¡¨æ¿ã€å†…å®¹åˆ†å¸ƒã€è´¨é‡æŠ¥å‘Šã€ä½¿ç”¨ç»Ÿè®¡

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æœåŠ¡

```bash
# ä½¿ç”¨Dockerï¼ˆæ¨èï¼‰
cd chaoX
docker-compose up -d

# æˆ–æœ¬åœ°å¼€å‘
cd chaoX/backend
pip install -r requirements.txt
uvicorn app:app --reload --port 8787
```

### 2. è®¿é—®æœåŠ¡

- ğŸ“š **ç”¨æˆ·ç«¯å‰ç«¯**: http://localhost:5173
- ğŸ”§ **åç«¯API**: http://localhost:8787
- ğŸ“– **APIæ–‡æ¡£**: http://localhost:8787/docs
- ğŸ” **ç®¡ç†åå°API**: http://localhost:8787/admin/

### 3. é»˜è®¤ç®¡ç†å‘˜ç™»å½•

```bash
# ç™»å½•
curl -X POST http://localhost:8787/admin/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'

# å“åº”ä¼šè¿”å›access_tokenï¼Œç”¨äºåç»­APIè°ƒç”¨
```

âš ï¸ **è¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼**

---

## ğŸ“Š APIæ¥å£æ¦‚è§ˆ

### ç”¨æˆ·ç«¯APIï¼ˆæ— éœ€è®¤è¯ï¼‰
```
POST   /ingest              # ä¸Šä¼ æ–‡æ¡£
GET    /search              # æœç´¢çŸ¥è¯†åº“
GET    /chunks/{id}         # è·å–åˆ†ç‰‡è¯¦æƒ…
GET    /meta/sections       # è·å–ç« èŠ‚ç»Ÿè®¡
POST   /api/qbank/ingest    # ä¸Šä¼ é¢˜åº“
GET    /api/qbank/search    # æœç´¢é¢˜åº“
```

### ç®¡ç†åå°APIï¼ˆéœ€è¦Tokenè®¤è¯ï¼‰
```
# è®¤è¯
POST   /admin/auth/login            # ç™»å½•
GET    /admin/auth/me               # è·å–å½“å‰ç”¨æˆ·
POST   /admin/auth/change-password  # ä¿®æ”¹å¯†ç 

# æ–‡æ¡£ç®¡ç†ï¼ˆéœ€è¦editoræƒé™ï¼‰
GET    /admin/docs                  # æ–‡æ¡£åˆ—è¡¨
GET    /admin/docs/{id}             # æ–‡æ¡£è¯¦æƒ…
PUT    /admin/docs/{id}             # æ›´æ–°æ–‡æ¡£
DELETE /admin/docs/{id}             # åˆ é™¤æ–‡æ¡£
POST   /admin/docs/batch-delete     # æ‰¹é‡åˆ é™¤

# åˆ†ç‰‡ç®¡ç†ï¼ˆéœ€è¦editoræƒé™ï¼‰
GET    /admin/chunks                # åˆ†ç‰‡åˆ—è¡¨
PUT    /admin/chunks/{id}           # æ›´æ–°åˆ†ç‰‡
POST   /admin/chunks/batch-verify   # æ‰¹é‡å®¡æ ¸
POST   /admin/chunks/batch-delete   # æ‰¹é‡åˆ é™¤

# é¢˜åº“ç®¡ç†ï¼ˆéœ€è¦editoræƒé™ï¼‰
GET    /admin/questions             # é¢˜ç›®åˆ—è¡¨
PUT    /admin/questions/{id}        # æ›´æ–°é¢˜ç›®
DELETE /admin/questions/{id}        # åˆ é™¤é¢˜ç›®

# ç”¨æˆ·ç®¡ç†ï¼ˆéœ€è¦adminæƒé™ï¼‰
GET    /admin/users                 # ç”¨æˆ·åˆ—è¡¨
POST   /admin/users                 # åˆ›å»ºç”¨æˆ·ï¼ˆsuperadminï¼‰
PUT    /admin/users/{id}            # æ›´æ–°ç”¨æˆ·
DELETE /admin/users/{id}            # åˆ é™¤ç”¨æˆ·ï¼ˆsuperadminï¼‰

# ç»Ÿè®¡åˆ†æï¼ˆéœ€è¦editoræƒé™ï¼‰
GET    /admin/stats/dashboard       # ä»ªè¡¨æ¿
GET    /admin/stats/content-distribution  # å†…å®¹åˆ†å¸ƒ
GET    /admin/stats/quality-report  # è´¨é‡æŠ¥å‘Š
GET    /admin/stats/usage           # ä½¿ç”¨ç»Ÿè®¡

# å®¡è®¡æ—¥å¿—ï¼ˆéœ€è¦adminæƒé™ï¼‰
GET    /admin/audit/logs            # æ—¥å¿—åˆ—è¡¨
GET    /admin/audit/activity/{id}   # ç”¨æˆ·æ´»åŠ¨
GET    /admin/audit/action-stats    # æ“ä½œç»Ÿè®¡
```

---

## ğŸ”‘ æƒé™ä½“ç³»

| è§’è‰² | æƒé™è¯´æ˜ |
|-----|---------|
| **superadmin** | è¶…çº§ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œå¯ä»¥ç®¡ç†ç”¨æˆ· |
| **admin** | ç®¡ç†å‘˜ï¼Œå¯ä»¥ç®¡ç†å†…å®¹å’ŒæŸ¥çœ‹æ—¥å¿—ï¼Œä¸èƒ½ç®¡ç†ç”¨æˆ· |
| **editor** | ç¼–è¾‘ï¼Œå¯ä»¥ç¼–è¾‘å†…å®¹å’Œå®¡æ ¸åˆ†ç‰‡ |
| **viewer** | æŸ¥çœ‹è€…ï¼Œåªè¯»æƒé™ |

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### ç°æœ‰è¡¨
- `doc` - æ–‡æ¡£å…ƒæ•°æ®
- `chunk` - æ–‡æ¡£åˆ†ç‰‡
- `question` - é¢˜åº“

### æ–°å¢ç®¡ç†è¡¨
- `admin_user` - ç®¡ç†å‘˜ç”¨æˆ·
- `audit_log` - å®¡è®¡æ—¥å¿—
- `kb_category` - çŸ¥è¯†åº“åˆ†ç±»
- `tag` - æ ‡ç­¾
- `doc_category` - æ–‡æ¡£åˆ†ç±»å…³è”
- `chunk_tag` - åˆ†ç‰‡æ ‡ç­¾å…³è”

### æ‰©å±•å­—æ®µ
- `doc`, `chunk`, `question` æ·»åŠ è½¯åˆ é™¤ã€å‘å¸ƒçŠ¶æ€ã€å®¡æ ¸çŠ¶æ€ç­‰å­—æ®µ

---

## ğŸ” å®‰å…¨ç‰¹æ€§

1. **JWTè®¤è¯**ï¼šåŸºäºTokençš„å®‰å…¨è®¤è¯æœºåˆ¶
2. **å¯†ç åŠ å¯†**ï¼šä½¿ç”¨bcryptåŠ å¯†å­˜å‚¨
3. **æƒé™æ§åˆ¶**ï¼šç»†ç²’åº¦çš„è§’è‰²æƒé™ç®¡ç†
4. **å®¡è®¡æ—¥å¿—**ï¼šå®Œæ•´è®°å½•æ‰€æœ‰æ“ä½œ
5. **è½¯åˆ é™¤**ï¼šæ”¯æŒæ•°æ®æ¢å¤
6. **Tokenè¿‡æœŸ**ï¼š24å°æ—¶è‡ªåŠ¨è¿‡æœŸï¼ˆå¯é…ç½®ï¼‰

---

## ğŸ“ˆ ç»Ÿè®¡åŠŸèƒ½

### ç³»ç»Ÿæ¦‚è§ˆ
- æ–‡æ¡£æ€»æ•°ã€åˆ†ç‰‡æ€»æ•°ã€é¢˜ç›®æ€»æ•°
- æ´»è·ƒç®¡ç†å‘˜æ•°é‡
- 24å°æ—¶æ“ä½œæ—¥å¿—æ•°é‡

### å†…å®¹åˆ†å¸ƒ
- æŒ‰ç±»å‹åˆ†å¸ƒï¼ˆdefinition/theorem/formula/exampleï¼‰
- æŒ‰ç« èŠ‚åˆ†å¸ƒ
- æŒ‰æ¥æºåˆ†å¸ƒï¼ˆkb/qbï¼‰

### è´¨é‡æŠ¥å‘Š
- åˆ†ç‰‡è´¨é‡åˆ†å¸ƒ
- å¾…å®¡æ ¸åˆ†ç‰‡ç»Ÿè®¡
- ä½è´¨é‡æ–‡æ¡£åˆ—è¡¨

### ä½¿ç”¨ç»Ÿè®¡
- æœç´¢é‡è¶‹åŠ¿
- æ´»è·ƒç”¨æˆ·ç»Ÿè®¡
- ä¸Šä¼ è¶‹åŠ¿åˆ†æ

---

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„APIç«¯ç‚¹

1. åœ¨ `admin/services/` åˆ›å»ºæœåŠ¡å‡½æ•°
2. åœ¨ `admin/routes/` åˆ›å»ºè·¯ç”±å¤„ç†
3. åœ¨ `admin/router.py` æ³¨å†Œè·¯ç”±
4. æ·»åŠ æƒé™æ£€æŸ¥è£…é¥°å™¨

ç¤ºä¾‹ï¼š
```python
# services/my_service.py
def get_my_data():
    return {...}

# routes/my_routes.py
from admin.auth import require_editor

@router.get("/my-endpoint")
async def my_endpoint(current_user: dict = Depends(require_editor)):
    data = get_my_data()
    return {"ok": True, "data": data}
```

### æ·»åŠ æ–°çš„æ•°æ®æ¨¡å‹

```python
# admin/models/my_model.py
from pydantic import BaseModel

class MyModel(BaseModel):
    field1: str
    field2: int
```

---

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•ï¼ˆå¾…å®ç°ï¼‰
pytest tests/

# æµ‹è¯•APIç«¯ç‚¹
curl http://localhost:8787/docs  # Swagger UI
```

---

## ğŸ“š æ–‡æ¡£

- [**ä½¿ç”¨æŒ‡å—**](./backend/ADMIN_GUIDE.md) - è¯¦ç»†çš„APIæ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜
- [**éƒ¨ç½²æŒ‡å—**](./backend/DEPLOYMENT.md) - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ­¥éª¤
- [**APIæ–‡æ¡£**](http://localhost:8787/docs) - è‡ªåŠ¨ç”Ÿæˆçš„Swaggeræ–‡æ¡£

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯
- **FastAPI** - ç°ä»£åŒ–Webæ¡†æ¶
- **PostgreSQL** - å…³ç³»å‹æ•°æ®åº“
- **psycopg2** - PostgreSQLé©±åŠ¨
- **bcrypt** - å¯†ç åŠ å¯†
- **PyJWT** - JWTä»¤ç‰Œå¤„ç†
- **python-docx** - Wordæ–‡æ¡£å¤„ç†

### å‰ç«¯
- **React** - UIæ¡†æ¶
- **TypeScript** - ç±»å‹å®‰å…¨
- **Tailwind CSS** - æ ·å¼æ¡†æ¶
- **KaTeX** - æ•°å­¦å…¬å¼æ¸²æŸ“

### éƒ¨ç½²
- **Docker** - å®¹å™¨åŒ–
- **Docker Compose** - æœåŠ¡ç¼–æ’

---

## ğŸ”„ ç‰ˆæœ¬å†å²

### v0.2.0 (Current)
- âœ¨ æ–°å¢å®Œæ•´çš„ç®¡ç†åå°ç³»ç»Ÿ
- âœ¨ ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†
- âœ¨ æ–‡æ¡£/åˆ†ç‰‡/é¢˜åº“ç®¡ç†åŠŸèƒ½
- âœ¨ å®¡è®¡æ—¥å¿—ç³»ç»Ÿ
- âœ¨ ç»Ÿè®¡åˆ†æåŠŸèƒ½
- ğŸ“ å®Œæ•´çš„æ–‡æ¡£å’Œéƒ¨ç½²æŒ‡å—

### v0.1.0
- âœ… åŸºç¡€æ–‡æ¡£ä¸Šä¼ å’Œæ£€ç´¢åŠŸèƒ½
- âœ… é¢˜åº“ç®¡ç†
- âœ… PostgreSQLé›†æˆ

---

## ğŸš§ æœªæ¥è§„åˆ’

### çŸ­æœŸï¼ˆv0.3.0ï¼‰
- [ ] ç®¡ç†åå°å‰ç«¯ç•Œé¢ï¼ˆReactï¼‰
- [ ] æ‰¹é‡å¯¼å…¥å¯¼å‡ºåŠŸèƒ½
- [ ] æ•°æ®å¤‡ä»½ä¸æ¢å¤
- [ ] æ›´å¤šç»Ÿè®¡å›¾è¡¨

### ä¸­æœŸï¼ˆv0.4.0ï¼‰
- [ ] å‘é‡æœç´¢æ”¯æŒï¼ˆpgvectorï¼‰
- [ ] æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶
- [ ] åä½œç¼–è¾‘åŠŸèƒ½
- [ ] è¯„è®ºå’Œæ ‡æ³¨

### é•¿æœŸ
- [ ] AIè¾…åŠ©åˆ†ç‰‡
- [ ] æ™ºèƒ½æ¨è
- [ ] ç§»åŠ¨ç«¯é€‚é…
- [ ] å¤šç§Ÿæˆ·æ”¯æŒ

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Forkæœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼š`git checkout -b feature/amazing-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add amazing feature'`
4. æ¨é€åˆ°åˆ†æ”¯ï¼š`git push origin feature/amazing-feature`
5. æäº¤Pull Request

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯

---

## ğŸ’¬ è”ç³»æ–¹å¼

- é—®é¢˜åé¦ˆï¼šé€šè¿‡ GitHub Issues
- æŠ€æœ¯æ”¯æŒï¼šæŸ¥çœ‹æ–‡æ¡£æˆ–è”ç³»ç®¡ç†å‘˜

---

## ğŸ‰ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œä½¿ç”¨è€…ï¼

---

**å¼€å§‹ä½¿ç”¨ï¼š**

1. æŸ¥çœ‹ [DEPLOYMENT.md](./backend/DEPLOYMENT.md) äº†è§£éƒ¨ç½²æ­¥éª¤
2. é˜…è¯» [ADMIN_GUIDE.md](./backend/ADMIN_GUIDE.md) å­¦ä¹ å¦‚ä½•ä½¿ç”¨
3. è®¿é—® http://localhost:8787/docs æŸ¥çœ‹å®Œæ•´APIæ–‡æ¡£

ç¥ä½¿ç”¨æ„‰å¿«ï¼ğŸŠ

